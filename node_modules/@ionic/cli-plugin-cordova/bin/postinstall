#!/usr/bin/env node

'use strict';

var chalk = require('chalk');
var crossSpawn = require('cross-spawn');

function getCommandInfo(cmd, args) {
  return new Promise((resolve, reject) => {
    let info = '';
    const proc = crossSpawn.spawn(cmd, args);

    proc.stdout.on('data', (data) => {
      info += data.toString('utf8');
    });

    proc.on('error', () => {
      resolve('Not installed');
    });

    proc.on('close', (code) => {
      if (code !== 0) {
        return resolve('Not installed');
      }
      resolve(info.replace('\n', ' '));
    });
  });
}

Promise.all([
  getCommandInfo('cordova', ['-v']),
  getCommandInfo('ios-deploy', ['--version']),
  getCommandInfo('ios-sim', ['--version'])
]).then(function(data) {
  var npmModules = []
  if (data[0] === "Not installed") {
    npmModules.push('cordova');
  }
  if (data[1] === "Not installed") {
    npmModules.push('ios-deploy');
  }
  if (data[2] === "Not installed") {
    npmModules.push('ios-sim');
  }
  if (npmModules.length > 0) {
    console.log('You will need to install the following global dependencies in order to use this plugin.')
    console.log(chalk.bold('npm install -g ' + npmModules.join(' ')) + '\n');
  } else {
    console.log(chalk.green('Looks like global dependencies are good to go!'));
  }
})
